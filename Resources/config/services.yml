services:
    vince.cms.form.handler:
        class: Vince\Bundle\CmsBundle\Form\Handler\CmsFormHandler
        calls:
            - [setChain, [@vince.processor.chain]]
            - [setRouter, [@router]]

    # Twig
    twig.extension.vince.cms:
        class: Vince\Bundle\CmsBundle\Twig\Extension\CmsExtension
        calls:
            - [setEntityManager, [@doctrine.orm.default_entity_manager]]
            - [setSecurityContext, [@security.context]]
            - [setMenuClass, [%vince.class.menu%]]
            - [setBlockClass, [%vince.class.block%]]
        tags:
            - { name: twig.extension }

    twig.extension.text:
        class: Twig_Extensions_Extension_Text
        tags:
            - { name: twig.extension }

    twig.extension.intl:
        class: Twig_Extensions_Extension_Intl
        tags:
            - { name: twig.extension }

    # Gedmo listeners
    gedmo.listener.tree:
        class: Gedmo\Tree\TreeListener
        tags:
            - { name: doctrine.event_subscriber, connection: default }
        calls:
            - [setAnnotationReader, [@annotation_reader]]

    gedmo.listener.timestampable:
        class: Gedmo\Timestampable\TimestampableListener
        tags:
            - { name: doctrine.event_subscriber, connection: default }
        calls:
            - [setAnnotationReader, [@annotation_reader]]

    gedmo.listener.sluggable:
        class: Gedmo\Sluggable\SluggableListener
        tags:
            - { name: doctrine.event_subscriber, connection: default }
        calls:
            - [setAnnotationReader, [@annotation_reader]]

    vince.cms.loader:
        class: Vince\Bundle\CmsBundle\Component\Routing\Loader
        tags:
            - { name: routing.loader }
        calls:
            - [setArticleClass, [%vince.class.article%]]
            - [setEntityManager, [@doctrine.orm.default_entity_manager]]

    # CMS loaders
    vince.cms.search.load.listener:
        class: Vince\Bundle\CmsBundle\Listener\SearchListener
        tags:
            - { name: kernel.event_listener, event: vince.cms.search.load, method: onLoad }
        calls:
            - [setArticleRepository, [@vince.repository.article]]

    vince.cms.contact.load.listener:
        class: Vince\Bundle\CmsBundle\Listener\ContactListener
        tags:
            - { name: kernel.event_listener, event: vince.cms.contact.load, method: onLoad }
        calls:
            - [setFormFactory, [@form.factory]]

    # CMS forms
    vince.processor.chain:
        class: Vince\Bundle\CmsBundle\Component\Chain\Chain

    vince.processor:
        class: Vince\Bundle\CmsBundle\Component\Processor\Processor
        abstract: true
        calls:
            - [setFormFactory, [@form.factory]]

    vince.processor.contact:
        class: Vince\Bundle\CmsBundle\Component\Processor\ContactProcessor
        parent: vince.processor
        tags:
            -  { name: vince.processor, alias: contact }
        calls:
            - [setMailer, [@mailer]]
            - [setTranslator, [@translator]]
            - [setTemplating, [@templating]]
            - [setSession, [@session]]
            - [setConfiguration, ["%vince.contact%"]]